<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SPMB & Humas - Embedded Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background: #f8fafc;
            padding: 0;
            margin: 0;
        }
        
        .embed-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* Tanpa footer */
        footer {
            display: none;
        }
        
        /* Hide sidebar and header for embed */
        .sidebar,
        .app-header,
        .mobile-header {
            display: none !important;
        }
        
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #cbd5e0;
            border-radius: 3px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }
    </style>
</head>
<body>
    <div class="embed-container">
        <!-- Header -->
        <div class="bg-white rounded-2xl shadow-sm p-6 mb-6">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-4">
                    <div class="w-12 h-12 bg-[#EF3F09] rounded-full flex items-center justify-center">
                        <i data-lucide="graduation-cap" class="w-6 h-6 text-white"></i>
                    </div>
                    <div>
                        <h1 class="text-[#0C1C3C] text-xl font-bold">SPMB & Humas Monitoring</h1>
                        <p class="text-gray-500 text-sm">Yayasan Insan Pendidikan Teknologi & Kejuruan • Real-time Data</p>
                    </div>
                </div>
                <div class="flex items-center gap-3">
                    <span class="text-xs text-gray-500" id="last-update">Memuat...</span>
                    <button onclick="refreshEmbedData()" class="p-2 hover:bg-gray-100 rounded-lg transition-all">
                        <i data-lucide="refresh-cw" class="w-4 h-4 text-gray-600"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- Stats Cards -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6" id="embed-stats">
            <div class="bg-white rounded-2xl p-6 shadow-sm border-l-4 border-[#3498db]">
                <p class="text-gray-500 text-sm mb-1">Total SMP</p>
                <p class="text-[#0C1C3C] text-3xl font-bold" id="stat-smp">0</p>
                <p class="text-xs text-gray-400 mt-1">Pendaftar</p>
            </div>
            <div class="bg-white rounded-2xl p-6 shadow-sm border-l-4 border-[#9b59b6]">
                <p class="text-gray-500 text-sm mb-1">Total SMK</p>
                <p class="text-[#0C1C3C] text-3xl font-bold" id="stat-smk">0</p>
                <p class="text-xs text-gray-400 mt-1">Pendaftar</p>
            </div>
            <div class="bg-white rounded-2xl p-6 shadow-sm border-l-4 border-[#10B981]">
                <p class="text-gray-500 text-sm mb-1">Early Bird</p>
                <p class="text-[#0C1C3C] text-3xl font-bold" id="stat-earlybird">0</p>
                <p class="text-xs text-gray-400 mt-1">Pendaftar</p>
            </div>
            <div class="bg-white rounded-2xl p-6 shadow-sm border-l-4 border-[#8B5CF6]">
                <p class="text-gray-500 text-sm mb-1">Gelombang 2</p>
                <p class="text-[#0C1C3C] text-3xl font-bold" id="stat-gelombang2">0</p>
                <p class="text-xs text-gray-400 mt-1">Pendaftar</p>
            </div>
        </div>

        <!-- Periode Breakdown -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
            <div class="bg-white rounded-2xl p-6 shadow-sm">
                <h3 class="text-[#0C1C3C] font-bold mb-4 flex items-center gap-2">
                    <i data-lucide="school" class="w-5 h-5 text-[#3498db]"></i>
                    SMP
                </h3>
                <div class="space-y-4" id="embed-smp-data">
                    <div class="flex justify-between text-sm">
                        <span class="text-gray-600">Early Bird:</span>
                        <span class="font-semibold" id="smp-earlybird">0</span>
                    </div>
                    <div class="flex justify-between text-sm">
                        <span class="text-gray-600">Gelombang 1:</span>
                        <span class="font-semibold" id="smp-gel1">0</span>
                    </div>
                    <div class="flex justify-between text-sm">
                        <span class="text-gray-600">Gelombang 2:</span>
                        <span class="font-semibold" id="smp-gel2">0</span>
                    </div>
                    <div class="flex justify-between text-sm pt-2 border-t">
                        <span class="font-medium">Total:</span>
                        <span class="font-bold text-[#EF3F09]" id="smp-total">0</span>
                    </div>
                </div>
            </div>
            <div class="bg-white rounded-2xl p-6 shadow-sm">
                <h3 class="text-[#0C1C3C] font-bold mb-4 flex items-center gap-2">
                    <i data-lucide="graduation-cap" class="w-5 h-5 text-[#9b59b6]"></i>
                    SMK
                </h3>
                <div class="space-y-4" id="embed-smk-data">
                    <div class="flex justify-between text-sm">
                        <span class="text-gray-600">Early Bird:</span>
                        <span class="font-semibold" id="smk-earlybird">0</span>
                    </div>
                    <div class="flex justify-between text-sm">
                        <span class="text-gray-600">Gelombang 1:</span>
                        <span class="font-semibold" id="smk-gel1">0</span>
                    </div>
                    <div class="flex justify-between text-sm">
                        <span class="text-gray-600">Gelombang 2:</span>
                        <span class="font-semibold" id="smk-gel2">0</span>
                    </div>
                    <div class="flex justify-between text-sm pt-2 border-t">
                        <span class="font-medium">Total:</span>
                        <span class="font-bold text-[#EF3F09]" id="smk-total">0</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Recent Agenda -->
        <div class="bg-white rounded-2xl p-6 shadow-sm">
            <h3 class="text-[#0C1C3C] font-bold mb-4">Agenda Terbaru</h3>
            <div class="overflow-x-auto">
                <table class="w-full">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase">Tanggal</th>
                            <th class="px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase">Kegiatan</th>
                            <th class="px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase">Lokasi</th>
                            <th class="px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase">Status</th>
                        </tr>
                    </thead>
                    <tbody id="embed-agenda" class="divide-y divide-gray-100">
                        <tr>
                            <td colspan="4" class="px-4 py-6 text-center text-gray-500">
                                Memuat data agenda...
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Update Info - Tanpa Footer -->
        <div class="mt-6 text-center text-xs text-gray-400">
            <span>Data real-time dari Google Spreadsheet</span>
            <span class="mx-2">•</span>
            <span>Update setiap 5 menit</span>
        </div>
    </div>

    <script>
        // Konfigurasi - Sesuaikan dengan Web App URL Anda
        const EMBED_CONFIG = {
            WEB_APP_URL: 'https://script.google.com/macros/s/AKfycbz1_rL0N24KmbVZE8AemOnDok_cQjInxpgvLquWFgGgtguDcPBZbKvNudHd8NDokvV-/exec',
            ACADEMIC_YEAR: '2026/2027'
        };

        // Load data saat halaman dimuat
        document.addEventListener('DOMContentLoaded', function() {
            lucide.createIcons();
            loadEmbedData();
            
            // Auto refresh setiap 5 menit
            setInterval(loadEmbedData, 5 * 60 * 1000);
        });

        // Fungsi untuk memuat data dari spreadsheet
        async function loadEmbedData() {
            try {
                document.getElementById('last-update').textContent = 'Memuat data...';
                
                const url = `${EMBED_CONFIG.WEB_APP_URL}?action=getAll&_=${Date.now()}`;
                const response = await fetch(url, {
                    mode: 'cors',
                    cache: 'no-cache'
                });
                
                if (!response.ok) throw new Error('Network response was not ok');
                
                const result = await response.json();
                
                if (result.success && result.data) {
                    processEmbedData(result.data);
                    document.getElementById('last-update').textContent = 
                        `Update: ${new Date().toLocaleString('id-ID')}`;
                } else {
                    // Fallback ke mock data
                    loadMockEmbedData();
                }
            } catch (error) {
                console.error('Error loading embed data:', error);
                loadMockEmbedData();
            }
        }

        // Fungsi untuk memproses data dari spreadsheet
        function processEmbedData(data) {
            // Proses data SPMB
            const spmbData = data.spmb_smp || [];
            
            // Hitung total per unit dan periode
            let smpTotal = 0, smkTotal = 0;
            let smpEarly = 0, smpGel1 = 0, smpGel2 = 0;
            let smkEarly = 0, smkGel1 = 0, smkGel2 = 0;
            
            // Filter berdasarkan tahun ajaran
            const filteredData = spmbData.filter(item => 
                item.tahun_ajaran === EMBED_CONFIG.ACADEMIC_YEAR
            );
            
            filteredData.forEach(item => {
                const unit = item.unit;
                const periode = item.periode;
                const pendaftar = parseInt(item.jumlah_pendaftar) || 0;
                
                if (unit === 'SMP') {
                    smpTotal += pendaftar;
                    if (periode === 'earlybird') smpEarly += pendaftar;
                    if (periode === 'gelombang1') smpGel1 += pendaftar;
                    if (periode === 'gelombang2') smpGel2 += pendaftar;
                } else if (unit === 'SMK') {
                    smkTotal += pendaftar;
                    if (periode === 'earlybird') smkEarly += pendaftar;
                    if (periode === 'gelombang1') smkGel1 += pendaftar;
                    if (periode === 'gelombang2') smkGel2 += pendaftar;
                }
            });

            // Update UI dengan data real
            document.getElementById('stat-smp').textContent = smpTotal;
            document.getElementById('stat-smk').textContent = smkTotal;
            document.getElementById('stat-earlybird').textContent = smpEarly + smkEarly;
            document.getElementById('stat-gelombang2').textContent = smpGel2 + smkGel2;
            
            // Update SMP data
            document.getElementById('smp-earlybird').textContent = smpEarly;
            document.getElementById('smp-gel1').textContent = smpGel1;
            document.getElementById('smp-gel2').textContent = smpGel2;
            document.getElementById('smp-total').textContent = smpTotal;
            
            // Update SMK data
            document.getElementById('smk-earlybird').textContent = smkEarly;
            document.getElementById('smk-gel1').textContent = smkGel1;
            document.getElementById('smk-gel2').textContent = smkGel2;
            document.getElementById('smk-total').textContent = smkTotal;
            
            // Update agenda
            const agendas = data.agenda_humas || [];
            renderEmbedAgenda(agendas.slice(0, 5));
        }

        // Fungsi untuk render agenda di embed
        function renderEmbedAgenda(agendas) {
            const tbody = document.getElementById('embed-agenda');
            
            if (!agendas || agendas.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="4" class="px-4 py-6 text-center text-gray-500">
                            Belum ada agenda
                        </td>
                    </tr>
                `;
                return;
            }
            
            tbody.innerHTML = agendas.map(agenda => {
                let statusClass = '';
                let statusText = '';
                
                switch(agenda.status) {
                    case 'completed':
                        statusClass = 'bg-success-light text-success-dark';
                        statusText = 'Selesai';
                        break;
                    case 'ongoing':
                        statusClass = 'bg-warning-light text-warning-dark';
                        statusText = 'Berlangsung';
                        break;
                    default:
                        statusClass = 'bg-info-light text-info-dark';
                        statusText = 'Terjadwal';
                }
                
                return `
                    <tr>
                        <td class="px-4 py-3 text-sm">${agenda.tanggal || '-'}</td>
                        <td class="px-4 py-3 text-sm font-medium">${agenda.kegiatan || '-'}</td>
                        <td class="px-4 py-3 text-sm text-gray-600">${agenda.lokasi || '-'}</td>
                        <td class="px-4 py-3 text-sm">
                            <span class="px-2 py-1 text-xs rounded-full ${statusClass}">${statusText}</span>
                        </td>
                    </tr>
                `;
            }).join('');
            
            lucide.createIcons();
        }

        // Mock data untuk fallback
        function loadMockEmbedData() {
            const mockData = {
                spmb_smp: [
                    { unit: 'SMP', tahun_ajaran: '2026/2027', periode: 'earlybird', jumlah_pendaftar: 45 },
                    { unit: 'SMP', tahun_ajaran: '2026/2027', periode: 'gelombang1', jumlah_pendaftar: 58 },
                    { unit: 'SMP', tahun_ajaran: '2026/2027', periode: 'gelombang2', jumlah_pendaftar: 48 },
                    { unit: 'SMK', tahun_ajaran: '2026/2027', periode: 'earlybird', jumlah_pendaftar: 68 },
                    { unit: 'SMK', tahun_ajaran: '2026/2027', periode: 'gelombang1', jumlah_pendaftar: 78 },
                    { unit: 'SMK', tahun_ajaran: '2026/2027', periode: 'gelombang2', jumlah_pendaftar: 58 }
                ],
                agenda_humas: [
                    {
                        tanggal: '2026-06-15',
                        kegiatan: 'Open House SMP',
                        lokasi: 'Aula Utama',
                        status: 'completed'
                    },
                    {
                        tanggal: '2026-06-20',
                        kegiatan: 'Workshop Teknologi',
                        lokasi: 'Lab Komputer',
                        status: 'ongoing'
                    },
                    {
                        tanggal: '2026-06-25',
                        kegiatan: 'Pameran Pendidikan',
                        lokasi: 'Mall Kota',
                        status: 'scheduled'
                    }
                ]
            };
            
            processEmbedData({ data: mockData });
            document.getElementById('last-update').textContent = 
                `Update: ${new Date().toLocaleString('id-ID')} (Data Demo)`;
        }

        // Manual refresh
        function refreshEmbedData() {
            loadEmbedData();
        }
    </script>
</body>
</html>
